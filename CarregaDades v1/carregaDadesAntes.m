function [datos,T,datos2] = carregaDades(file,si)


close all
clc
format long

% Preparem les dades del fitxer
% file = 'Z:\LV\grupo 1\28-11-2013_Clementina_10mL_1.txt';
newfile = strrep(file,'.txt','_punto.txt');

if exist(newfile,'file')==0
copyfile(file,newfile);
comma2point_overwrite(newfile);
eliminaLineas(newfile);
end

data = tdfread(newfile);
%Base temporal
T = data.Time;

%Coeficients del filtre de la senyal
coeff = [0,000030,0,000132,0,000236,0,000342,0,000450,0,000559,0,000670,0,000783,0,000898,0,001014,0,001132,0,001251,0,001372,0,001494,0,001618,0,001743,0,001869,0,001996,0,002124,0,002254,0,002384,0,002515,0,002647,0,002780,0,002914,0,003048,0,003183,0,003319,0,003454,0,003591,0,003727,0,003864,0,004001,0,004138,0,004275,0,004412,0,004549,0,004685,0,004822,0,004958,0,005093,0,005228,0,005363,0,005497,0,005630,0,005762,0,005894,0,006024,0,006154,0,006282,0,006410,0,006536,0,006661,0,006784,0,006906,0,007027,0,007145,0,007263,0,007378,0,007492,0,007604,0,007714,0,007822,0,007928,0,008032,0,008134,0,008234,0,008331,0,008426,0,008519,0,008609,0,008696,0,008782,0,008864,0,008944,0,009021,0,009096,0,009168,0,009237,0,009303,0,009366,0,009426,0,009484,0,009538,0,009589,0,009638,0,009683,0,009725,0,009764,0,009800,0,009832,0,009862,0,009888,0,009911,0,009930,0,009947,0,009960,0,009970,0,009976,0,009980,0,009980,0,009976,0,009970,0,009960,0,009947,0,009930,0,009911,0,009888,0,009862,0,009832,0,009800,0,009764,0,009725,0,009683,0,009638,0,009589,0,009538,0,009484,0,009426,0,009366,0,009303,0,009237,0,009168,0,009096,0,009021,0,008944,0,008864,0,008782,0,008696,0,008609,0,008519,0,008426,0,008331,0,008234,0,008134,0,008032,0,007928,0,007822,0,007714,0,007604,0,007492,0,007378,0,007263,0,007145,0,007027,0,006906,0,006784,0,006661,0,006536,0,006410,0,006282,0,006154,0,006024,0,005894,0,005762,0,005630,0,005497,0,005363,0,005228,0,005093,0,004958,0,004822,0,004685,0,004549,0,004412,0,004275,0,004138,0,004001,0,003864,0,003727,0,003591,0,003454,0,003319,0,003183,0,003048,0,002914,0,002780,0,002647,0,002515,0,002384,0,002254,0,002124,0,001996,0,001869,0,001743,0,001618,0,001494,0,001372,0,001251,0,001132,0,001014,0,000898,0,000783,0,000670,0,000559,0,000450,0,000342,0,000236,0,000132,0,000030];

data = rmfield(data,'Time'); %eliminem vector temps
datos = struct2dataset(data); %carreguem la resta de dades en una matriu
datos = double(datos); 
[f,c] = size(datos); %nombre de dades per vector
datos = datos(100:f,:); %eliminem les 100 primeres mostres (realment el que fem es carregar desde 100 fins al final)



T=T(100:f); 

for i= 1:c
   
    datos2(:,i)=filtfilt(coeff,1,datos(:,i));
    
end

datos = datos2;
clear datos2;

[f,c] = size(datos);


for i=1:c
    
    min1=  min(datos(1:si,i));
    
    maxim = ((max(datos(:,i)) - min1)*0.85 )+ min1;
    maxim2 = ((max(datos(:,i)) - min1)*0.98 )+ min1;
    minim = ((max(datos(1:si,i)) - min1)*0.05 )+ min1;
    
    
    for j=1:f
        
        if (datos(j,i)) >= maxim2 
            
            datos2(j,i) = maxim2;
            
        elseif (datos(j,i)) > maxim
            
            datos2(j,i) = maxim;
            
        elseif (datos(j,i)) < minim 
            
            datos2(j,i) = minim;
            
        else
            
            datos2(j,i) = datos(j,i);
            
        end
    end
    
    
    
end





end